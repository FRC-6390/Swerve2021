!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):(e=e||self,r(e.webbitStore={}))}(this,function(e){"use strict";function r(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function t(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))})}return e}function o(e,r,t,n){var o=-1,u=e?e.length:0;for(n&&u&&(t=e[++o]);++o<u;)t=r(t,e[o],o,e);return t}function u(e){return e.split("")}function i(e){return e.match(j)||[]}function f(e){return B.test(e)}function c(e){return G.test(e)}function s(e){return f(e)?a(e):u(e)}function a(e){return e.match(Z)||[]}function d(e){return e.match(M)||[]}function _(e,r,t){var n=-1,o=e.length;r<0&&(r=-r>o?0:o+r),(t=t>o?o:t)<0&&(t+=o),o=r>t?0:t-r>>>0,r>>>=0;for(var u=Array(o);++n<o;)u[n]=e[n+r];return u}function v(e){if("string"==typeof e)return e;if(h(e))return X?X.call(e):"";var r=e+"";return"0"==r&&1/e==-m?"-0":r}function l(e,r,t){var n=e.length;return t=void 0===t?n:t,!r&&t>=n?e:_(e,r,t)}function p(e){return!!e&&"object"==typeof e}function h(e){return"symbol"==typeof e||p(e)&&F.call(e)==O}function y(e){return null==e?"":v(e)}function b(e){return re(y(e).toLowerCase())}function g(e){return(e=y(e))&&e.replace(w,$).replace(V,"")}function x(e,r,t){return e=y(e),r=t?void 0:r,void 0===r?c(e)?d(e):i(e):e.match(r)||[]}var m=1/0,O="[object Symbol]",j=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,w=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,E="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",P="["+E+"]",S="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",A="[a-z\\xdf-\\xf6\\xf8-\\xff]",N="[^\\ud800-\\udfff"+E+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",U="\\ud83c[\\udffb-\\udfff]",z="(?:\\ud83c[\\udde6-\\uddff]){2}",k="[\\ud800-\\udbff][\\udc00-\\udfff]",T="[A-Z\\xc0-\\xd6\\xd8-\\xde]",C="(?:"+A+"|"+N+")",I="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",K="[\\ufe0e\\ufe0f]?"+I+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",z,k].join("|")+")[\\ufe0e\\ufe0f]?"+I+")*"),R="(?:"+["[\\u2700-\\u27bf]",z,k].join("|")+")"+K,D="(?:"+["[^\\ud800-\\udfff]"+S+"?",S,z,k,"[\\ud800-\\udfff]"].join("|")+")",L=RegExp("['’]","g"),V=RegExp(S,"g"),Z=RegExp(U+"(?="+U+")|"+D+K,"g"),M=RegExp([T+"?"+A+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[P,T,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[P,T+C,"$"].join("|")+")",T+"?"+C+"+(?:['’](?:d|ll|m|re|s|t|ve))?",T+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d+",R].join("|"),"g"),B=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),G=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,W={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"ss"},Y="object"==typeof global&&global&&global.Object===Object&&global,H="object"==typeof self&&self&&self.Object===Object&&self,J=Y||H||Function("return this")(),$=function(e){return function(r){return null==e?void 0:e[r]}}(W),F=Object.prototype.toString,q=J.Symbol,Q=q?q.prototype:void 0,X=Q?Q.toString:void 0,ee=function(e){return function(r){return o(x(g(r).replace(L,"")),e,"")}}(function(e,r,t){return r=r.toLowerCase(),e+(t?b(r):r)}),re=function(e){return function(r){var t=f(r=y(r))?s(r):void 0,n=t?t[0]:r.charAt(0),o=t?l(t,1).join(""):r.slice(1);return n[e]()+o}}("toUpperCase"),te=e=>e.split("/").map(e=>ee(e)).join("/"),ne={},oe={},ue=null,ie=[],fe=[],ce=e=>{var{typeName:typeName}=e;if("string"!=typeof typeName)throw new Error("A typeName for your source provider type must be set.");if(se(typeName))throw new Error("A source provider type with the same name has already been added.");"SourceProvider"===e.__WEBBIT_CLASSNAME__&&(ne[typeName]=e)},se=e=>e in ne,ae=(e,r,t)=>{t=t||{};"string"!=typeof r&&(r=e);if(!se(e))throw new Error("A source provider type with that name hasn't been added.");if(he(r))throw new Error("A source provider with that name has already been added.");var o=ne[e];oe[r]=new o(r,n({},o.settingsDefaults));ie.forEach(e=>{e(r)});return oe[r]},de=e=>{if("function"!=typeof e)throw new Error("listener is not a function");ie.push(e)},_e=e=>{if(!he(e))return;var r=oe[e];r._disconnect();delete oe[e]},ve=e=>oe[e],le=()=>Object.keys(ne),pe=()=>Object.keys(oe),he=e=>e in oe,ye=e=>{ue=e;fe.forEach(e=>{e(ue)})},be=()=>ue,ge=e=>{if("function"!=typeof e)throw new Error("listener is not a function");fe.push(e)};class xe{static get __WEBBIT_CLASSNAME__(){return"Source"}}var me={},Oe={},je={},we={},Ee={},Pe=0,Se=()=>({__normalizedKey__:void 0,__fromProvider__:!1,__key__:void 0,__value__:void 0,__sources__:{}}),Ae=()=>({getterValues:{},setters:{},sources:{}}),Ne=(e,r)=>{r=te(r);void 0===je[e]&&(je[e]={});void 0===je[e][r]&&(je[e][r]=new xe);return je[e][r]},Ue=(e,r,t)=>{var n=Ne(e,r);Object.getOwnPropertyNames(n).forEach(e=>{if(e in t.__sources__)return;delete n[e]});for(var o in t.__sources__){(function(r){var o=te(r);if(o in n)return"continue";var u=t.__sources__[r];Object.defineProperty(n,o,{configurable:!0,set(r){var t=Oe[e];if(void 0!==t){var n=t.setters[u.__normalizedKey__];void 0!==n&&n(r)}},get(){if(void 0!==Oe[e])return Oe[e].getterValues[u.__normalizedKey__]}})})(o)}},ze=(e,r)=>{var t=te(r).split("/");e in we&&t.forEach((n,o)=>{var u=t.slice(0,o+1).join("/");for(var i in we[e][u]||{})(0,we[e][u][i])(De(e,u),u,te(r))});if(e in Ee)for(var n in Ee[e])(0,Ee[e][n])(De(e,r),te(r))},ke=(e,r,t)=>{if(e in we)for(var n of r){n=te(n);for(var o in we[e][n])(0,we[e][n][o])(void 0,n,n)}if(e in Ee)for(var u of t||r)for(var i in Ee[e])(0,Ee[e][i])(void 0,u)},Te=e=>e instanceof Object&&"Source"===e.constructor.__WEBBIT_CLASSNAME__,Ce=(e,r,t)=>{if(0===t.length)return!1;var n=t[0];var o=r[n];if(void 0===o)return!1;t.length>1&&Ce(e,o.__sources__,t.slice(1));if(0!==Object.keys(o.__sources__).length||o.__fromProvider__){var u=Oe[e];Ue(e,o.__normalizedKey__,o),0===Object.keys(o.__sources__).length&&(u.getterValues[o.__normalizedKey__]=o.__value__)}else delete r[n],delete Oe[e].sources[o.__normalizedKey__],delete Oe[e].getterValues[o.__normalizedKey__],delete Oe[e].setters[o.__normalizedKey__],ke(e,[o.__normalizedKey__]);return!0},Ie=e=>me[e],Ke=(e,r)=>{var t=Ie(e);if(void 0===t)return;if("string"!=typeof r)return t;var n=te(r).split("/");var o=t.__sources__;for(var u in n){var i=n[u];if(n.length-1===parseInt(u))return i in o?o[i]:void 0;if(!(i in o))return;o=o[i].__sources__}return},Re=e=>{if(e in Oe)return Oe[e].sources;return},De=(e,r)=>{var t=Re(e);if(t)return t[te(r)];return},Le=(e,r,t,n)=>{if("function"!=typeof t)throw new Error("Callback is not a function");var o=te(r);void 0===we[e]&&(we[e]={});void 0===we[e][o]&&(we[e][o]={});var u=Pe;Pe++;we[e][o][u]=t;if(n){var i=De(e,o);void 0!==i&&t(i,r,r)}var f=()=>{delete we[e][o][u]};return f},Ve=(e,r,t)=>{if("function"!=typeof r)throw new Error("Callback is not a function");void 0===Ee[e]&&(Ee[e]={});var n=Pe;Pe++;Ee[e][n]=r;if(t){var o=Re(e);Object.getOwnPropertyNames(o||{}).forEach(t=>{var n=Ke(e,t);if(n.__fromProvider__){var u=o[t];r(u,t)}})}var u=()=>{delete Ee[e][n]};return u},Ze=e=>{var r=e in me;if(!r)return;var t=Object.getOwnPropertyNames(Re(e)||{});var n=t.filter(r=>Ke(e,r).__fromProvider__);for(var o in Oe[e].getterValues)!function(r){var t=Oe[e].getterValues[r];Te(t)&&Object.getOwnPropertyNames(t).forEach(e=>{delete t[e]})}(o);me[e]=Se();Oe[e]=Ae();ke(e,t,n)},Me=(e,r)=>{if(void 0===me[e])return;var t=me[e];for(var n of r){var o=te(n).split("/"),u=t.__sources__;for(var i in o){var f=o[i];if(!(f in u))break;o.length-1===parseInt(i)&&(u[f].__fromProvider__=!1,u[f].__value__=void 0),u=u[f].__sources__}Ce(e,t.__sources__,o)}},Be=(e,r)=>{void 0===me[e]&&(me[e]=Se(),Oe[e]=Ae());var t=me[e];for(var n in r)!function(n){var o=r[n],u=n.split("/"),i=te(n).split("/"),f=t.__sources__,c={};i.forEach((r,t)=>{var n=r in f;var s=u.slice(0,t+1).join("/");var a=Oe[e];var d=i.slice(0,t+1).join("/");n||(f[r]={__fromProvider__:!1,__normalizedKey__:d,__key__:s,__value__:void 0,__sources__:{}},a.getterValues[d]=Ne(e,s),a.setters[d]=(()=>{}),Object.defineProperty(a.sources,d,{configurable:!0,set(r){var t=Oe[e];if(void 0!==t){var n=t.setters[d];void 0!==n&&n(r)}},get(){if(void 0!==Oe[e])return Oe[e].getterValues[d]}}));if(i.length-1===t){f[r].__fromProvider__=!0,f[r].__value__=o,0===Object.keys(f[r].__sources__).length&&(a.getterValues[d]=o);var _=ve(e);a.setters[d]=(e=>{_.userUpdate(s,e)})}0!==t&&(Te(a.getterValues[c.__normalizedKey__])||(a.getterValues[c.__normalizedKey__]=Ne(e,c.__normalizedKey__)),Ue(e,c.__normalizedKey__,c));c=f[r];f=f[r].__sources__}),ze(e,n)}(n)};class Ge{static get __WEBBIT_CLASSNAME__(){return"SourceProvider"}static get typeName(){return null}static get settingsDefaults(){return{}}constructor(e,r){if(new.target===Ge)throw new TypeError("Cannot construct SourceProvider instances directly.");if("string"!=typeof e)throw new TypeError("The providerName needs to be passed into super() from your provider's constructor.");if(void 0===r)throw new Error("settings must be passed into the super() from your provider's constructor.");if("string"!=typeof this.constructor.typeName)throw new Error("A typeName string must be defined.");this._providerName=e,this.settings=n({},this.constructor.settingsDefaults),this._sourceUpdates={},this._interval=setInterval(this._sendUpdates.bind(this),100)}updateSource(e,r){void 0===this._sourceUpdates[e]?this._sourceUpdates[e]={first:{type:"change",value:r}}:this._sourceUpdates[e].last={type:"change",value:r}}removeSource(e){void 0===this._sourceUpdates[e]?this._sourceUpdates[e]={first:{type:"removal"}}:this._sourceUpdates[e].last={type:"removal"}}subscribe(e,r,t){return Le(this._providerName,e,r,t)}subscribeAll(e,r){return Ve(this._providerName,e,r)}getSource(e){return De(this._providerName,e)}getRawSource(e){return Ke(this._providerName,e)}getSources(){return Re(this._providerName)}clearSources(e){this._sendUpdates(()=>{Ze(this._providerName);"function"==typeof e&&e()})}userUpdate(e,r){}getType(e){return"string"==typeof e?"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":e instanceof Array?"Array":null===e?"null":null}_disconnect(){clearTimeout(this._interval)}_sendUpdates(e){if(0===Object.keys(this._sourceUpdates).length)return void("function"==typeof e&&e());var r={},t={};for(var n in this._sourceUpdates){var o=this._sourceUpdates[n];r[n]=o.first,"last"in o&&(t[n]=o.last)}this._sendChanges(r),this._sendRemovals(r),Object.keys(t).length>0?setTimeout(()=>{this._sendChanges(t);this._sendRemovals(t);this._sourceUpdates={};"function"==typeof e&&e()}):(this._sourceUpdates={},"function"==typeof e&&e())}_sendChanges(e){var r={};for(var t in e)"change"===e[t].type&&(r[t]=e[t].value);Object.keys(r).length>0&&Be(this._providerName,r)}_sendRemovals(e){var r=[];for(var t in e)"removal"===e[t].type&&r.push(t);r.length>0&&Me(this._providerName,r)}}var We=Ge;e.SourceProvider=We,e.addSourceProvider=ae,e.addSourceProviderType=ce,e.defaultSourceProviderSet=ge,e.getDefaultSourceProvider=be,e.getRawSource=Ke,e.getRawSources=Ie,e.getSource=De,e.getSourceProvider=ve,e.getSourceProviderNames=pe,e.getSourceProviderTypeNames=le,e.getSources=Re,e.hasSourceProvider=he,e.hasSourceProviderType=se,e.removeSourceProvider=_e,e.setDefaultSourceProvider=ye,e.sourceProviderAdded=de,e.subscribe=Le,e.subscribeAll=Ve,Object.defineProperty(e,"__esModule",{value:!0})});
